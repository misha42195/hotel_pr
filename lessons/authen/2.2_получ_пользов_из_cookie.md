Получение пользоватля из данных cookie:
Логика здесь такая:

1) Когда мы авторизуемся, то устанавливаем в cookie токен, и этот токен
   идентифицирует пользователя, и через этот токен мы можем получить обратно данные о пользователе
   сами cookie хранятся в объекте запроса объекта request, поэтому обращаемся
   к request.cookies.get("имя токена",None)
2) Нам нужно вытащить данные о пользователе из токена, то есть надо декодировать токен
   Используем функцию библиотеки jwt.decode(token,settings.JWT_SECRET_KEY,algorithms=settings.JWY_ALGORITHM)
   полученные данные можем использовать для получения уже конкретного пользователя
   из БД

1) в классе AuthService реализовать метод декодирования токена используя
   функцию jwt.decode(token, settings.JWT_SECRET_KEY, algorithms=[settings.JWY_ALGORITHM])

```python

@router.get("/only_auth")
async def only_auth(
        request: Request
):
    access_token = request.cookies.get("access_token", None)
    data = AuthService().decode_token(access_token)
    print(access_token)  # печатаем токен для себя
    user_id = data['user_id']  # получаем id, по которому можем обратиться
    # к базе и получить данные из базы
    # для этого откроем сессию,
    async with async_session_maker() as session:
        user = await UserRepository(session).get_one_or_none(id=user_id)

    return user
```

Пройдемся по строчно по ручке only_auth
request: Request - объект запроса внутри fastapi
access_token = request.cookies.get("access_token", None) получаем токен из cookie
data = AuthService().decode_token(access_token) получаем данные из декодировав токен
user_id = data['user_id'] получаем id пользователя из декодированных данный
user = await UserRepository(session).get_one_or_none(id=user_id) получаем
пользователя из базы, передав id пользователя