В логике ручек мы должны работать непосредственно только со значениями, которые отправляем в базу
данных. В ручке "/me" мы дополнительно пишем логику получения токена из объекта request,
далее декодируем токен, получаем id по ключу user_id
То есть происходит смешивание разных функций и вызов внутри ручки, но
нам бы хотелось от этого избавиться и вынести логику получения значения
user_id в файл dependenci.py и уже там получить значение id пользователя

Разбиваем получение значения user_id на две функции
get_token получает объект запроса, откуда вернем значение токена, если он есть, если его нет обработаем ошибку,
ведь пользователь может быть не аутентифицирован, а мы пытаемся получить доступ, надо обработать этот случай
и вернуть ошибку: "Вы не предоставили токен доступа"

```python
def get_token(request: Request) -> str:
    token = request.cookies.get("access_token", None)
    if not token:
        raise HTTPException(status_code=401, detail="Вы не предоставили токен доступа")
    return token
```

get_current_user_id-принимает значение токена, декодирует токен, получает пользователя по ключу "user_id"
и возвращает его

```python
# token-значение, которе получаем из функции get_token
def get_current_user_id(token: str = Depends(get_token)) -> int:
    data = AuthService().decode_token(token)

    user_id = data.get('user_id', None)
    return user_id


# UserIdDep-это тип для user_id, который возвращает функция get_current_user_id и в итоге получаем значение,
# которе используем для получения конкретного пользователя из базы данных 
UserIdDep = Annotated[int, Depends(get_current_user_id)]
```

ВЫВОД: Depends класс принимает вызываемый объект, а возвращает значение, которое возвращает переданный аргумент,

в этом методе включаем дополнительную проверку на подлинность токена, то есть токен должен быть правильный,
что бы его декодитровать, или показать ошибку что токен неверный, а не пугать пользователя неизвестной ошибкой

```python
def decode_token(self, token: str) -> str:
    try:
        return jwt.decode(token, settings.JWT_SECRET_KEY, algorithms=settings.JWY_ALGORITHM)
    except jwt.exceptions.DecodeError:
        raise HTTPException(status_code=401, detail="У вас неверный токен")
```
